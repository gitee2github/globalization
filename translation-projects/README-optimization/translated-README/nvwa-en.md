# nvwa

#### Introduction

nvwa is a tool used for automated hot upgrades of openEuler.

#### Construction Method

```
cd src
go get nvwa
go build
```

#### About Configuration

The configuration file is placed in the **config** directory. When running, the binary system will search for the configuration file in three places, in the following order:

1. Running directory
2. **config** subdirectory of the running directory
3. **/etc/nvwa**

The configuration files include:

1. **nvwa-restore.yaml**

Processes and services that need to be restored on-site. For each service, nvwa will modify the the configuration of systemd and restore the running state through systemd.

2. **nvwa-server.yaml**

Directories, logs, binary directory configurations, etc. required for hot upgrades.


#### Supported Commands

- **nvwa update** -- Hot upgrade to the corresponding kernel version (relevant files must be placed under **/boot**)

  nvwa will search for the required kernel and rootfs in the **/boot** directory. The kernel must be named in the **vmlinuz**-<version> format and the rootfs must be named in  **initramfs**-<version>**.img** format.

+ **nvwa help**

    Display helpful information about the client.

+ **nvwa init**

    Delete the image generated by nvwa and modify the service.

## Restrictions on Restoring the Service

The standard output and error output of the service must be set to files.
The pid occupation error may occur during service restoration.

## Check nvwa Run Log

> service nvwa status

## Development Plan

+ Manage the logs of **criu/kexec/nvwa** in a centralized manner.
+ Print timestamps and automatically calculate the delay.

## Kernel Boot Acceleration Patch
+ The patch is stored in the patches directory. Different kernel versions have different patch sets.
